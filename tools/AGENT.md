# Agent Guidelines - Tools Directory

## üéØ Purpose
Utility scripts for timeline maintenance, quality assurance, and automation.

## üìÅ Directory Structure
```
tools/
‚îú‚îÄ‚îÄ archiving/       # Source archiving and link checking
‚îú‚îÄ‚îÄ generation/      # Timeline generation and formatting
‚îú‚îÄ‚îÄ qa/             # Quality assurance and testing
‚îî‚îÄ‚îÄ validation/     # Event validation and fixes
```

## üîß Tool Categories

### Archiving Tools (`/archiving/`)
Scripts for preserving sources and checking link integrity.

#### archive_with_progress.py
- **Purpose**: Archive sources to archive.org with progress tracking
- **Rate Limit**: 5 requests per minute
- **Usage**: `python archive_with_progress.py`
- **Output**: Updates `archive_progress.json`

#### link_check.py
- **Purpose**: Verify all source links are accessible
- **Usage**: `python link_check.py`
- **Report**: Broken links to `link_test_summary.json`

#### batch_archive.py
- **Purpose**: Archive multiple sources in batch
- **Features**: Retry logic, progress saving

### Generation Tools (`/generation/`)
Scripts for building timeline outputs and indexes.

#### build_timeline_index.py
- **Purpose**: Generate searchable timeline index
- **Output**: `timeline_index.json`
- **Updates**: Actor lists, tag clouds, statistics

#### build_footnotes.py
- **Purpose**: Generate citation footnotes
- **Format**: Academic citation style
- **Output**: Markdown with numbered citations

#### fix_timeline_ids.py
- **Purpose**: Standardize event ID formatting
- **Pattern**: `YYYY-MM-DD--event-name-with-hyphens`
- **CRITICAL**: Never use underscores in IDs

### QA Tools (`/qa/`)
Quality assurance and testing utilities.

#### timeline_qa_system.py
- **Purpose**: Comprehensive QA checks
- **Checks**:
  - Source verification
  - Date consistency
  - Duplicate detection
  - Schema validation
  - Summary completeness

#### manual_qa_helper.py
- **Purpose**: Interactive QA interface
- **Features**: Review queue, validation tracking
- **Output**: QA reports and status updates

### Validation Tools (`/validation/`)
Event validation and automated fixes.

#### validate_timeline_dates.py
- **Purpose**: Verify date formatting and logic
- **Checks**:
  - Future events not marked 'confirmed'
  - Date format consistency
  - Chronological ordering

#### check_all_links.py
- **Purpose**: Comprehensive link validation
- **Features**: HTTP status checking, redirect following
- **Output**: Broken link report

#### auto_fix_simple_cases.py
- **Purpose**: Automated common fixes
- **Fixes**:
  - YAML escaping issues
  - Date format standardization
  - Whitespace cleanup
  - Quote normalization

#### smart_qa.py
- **Purpose**: AI-assisted validation
- **Features**: Content verification, source matching
- **Usage**: Requires API keys for AI services

## üîÑ Standard Workflows

### Daily Maintenance
```bash
# 1. Check for broken links
cd tools/validation
python check_all_links.py

# 2. Archive new sources
cd ../archiving
python archive_with_progress.py

# 3. Run QA checks
cd ../qa
python timeline_qa_system.py
```

### Weekly Tasks
```bash
# Full validation suite
python tools/qa/timeline_qa_system.py --full

# Archive all unarchived sources
python tools/archiving/batch_archive.py

# Generate fresh indexes
python tools/generation/build_timeline_index.py
```

### Before Release
```bash
# 1. Fix common issues
python tools/validation/auto_fix_simple_cases.py

# 2. Validate all dates
python tools/validation/validate_timeline_dates.py

# 3. Full QA check
python tools/qa/timeline_qa_system.py --comprehensive

# 4. Generate static API
cd timeline_data
python generate_static_api.py
```

## ‚ö†Ô∏è Critical Rules

### Never Break These
1. **Rate Limits**: Respect archive.org 5/min limit
2. **ID Format**: Always use hyphens, never underscores
3. **Backup First**: Always backup before bulk operations
4. **Test First**: Run with `--dry-run` when available

### YAML Handling
```python
# ALWAYS escape apostrophes properly
title = "Trump's Business"  # Use double quotes
# NOT: title = 'Trump's Business'  # Will fail

# Handle dates correctly
if isinstance(date, str):
    date_str = date
elif hasattr(date, 'isoformat'):
    date_str = date.isoformat()
```

## üìä Output Files

### Generated by Tools
- `archive_progress.json` - Archive status tracking
- `link_test_summary.json` - Link validation results
- `timeline_index.json` - Searchable index
- `validation_status.json` - Validation tracking
- `timeline_complete.json` - Full timeline data

### Log Files
- `archive.log` - Archiving activity
- `scrape_output.log` - Source scraping logs
- `validation.log` - Validation results

## üö® Troubleshooting

### Common Issues

#### Archive Rate Limiting
```python
# If hitting rate limits, adjust delay
ARCHIVE_DELAY = 12  # seconds between requests
```

#### YAML Parsing Errors
```bash
# Find and fix YAML issues
python tools/validation/auto_fix_simple_cases.py
python timeline_data/validate_yaml.py
```

#### Memory Issues with Large Operations
```python
# Process in batches
BATCH_SIZE = 50  # Reduce if needed
```

## üîß Tool Development

### Adding New Tools
1. Follow existing patterns
2. Include `--dry-run` option
3. Log all operations
4. Save progress for resumability
5. Handle errors gracefully

### Standard Imports
```python
import json
import yaml
import logging
from pathlib import Path
from datetime import datetime
import time
import requests
from typing import Dict, List, Optional
```

### Error Handling Pattern
```python
def safe_operation(file_path):
    try:
        # Operation
        result = process_file(file_path)
        logging.info(f"Success: {file_path}")
        return result
    except Exception as e:
        logging.error(f"Failed {file_path}: {e}")
        return None
```

## üìã Quality Standards

### Tool Requirements
- Clear help text and documentation
- Progress indicators for long operations
- Resumable operations (save state)
- Dry-run mode for safety
- Comprehensive logging
- Error recovery mechanisms

### Performance Guidelines
- Process files in batches
- Implement caching where appropriate
- Respect API rate limits
- Minimize memory usage
- Provide time estimates

## üéØ Tool Priorities

### High Priority
1. Link checking (sources disappear)
2. Archive creation (preserve evidence)
3. YAML validation (prevents breaks)
4. Duplicate detection (data quality)

### Medium Priority
1. Statistics generation
2. Index building
3. Citation formatting
4. Actor network analysis

### Low Priority
1. Visualization generation
2. Report formatting
3. Historical analysis
4. Trend detection

## üöÄ Quick Commands

### Most Used
```bash
# Validate everything
python timeline_data/validate_yaml.py

# Check links
python tools/validation/check_all_links.py

# Archive sources
python tools/archiving/archive_with_progress.py

# Run QA
python tools/qa/timeline_qa_system.py

# Fix common issues
python tools/validation/auto_fix_simple_cases.py
```

### Emergency Fixes
```bash
# Fix YAML syntax
python tools/validation/auto_fix_simple_cases.py

# Find duplicates
python tools/qa/timeline_qa_system.py --duplicates

# Validate dates
python tools/validation/validate_timeline_dates.py
```

---

*"Tools amplify capability. Good tools amplify good judgment. These tools are your force multipliers in the fight for truth."*