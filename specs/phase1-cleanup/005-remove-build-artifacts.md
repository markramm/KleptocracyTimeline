# SPEC-005: Remove Build Artifacts

**Status**: Ready
**Priority**: Low
**Estimated Time**: 5 minutes
**Risk**: Very Low
**Dependencies**: None

## Problem

Repository contains build artifacts and cache files that should not be committed:
- Python bytecode cache (`__pycache__/`, `*.pyc`)
- Test caches (`.pytest_cache/`)
- Type checking caches (`.mypy_cache/`)
- Coverage reports (`coverage_html/`, `htmlcov/`)
- Temporary files (`tmp/`)

These files:
- Bloat repository size
- Can cause merge conflicts
- Are environment-specific
- Should be regenerated locally

## Goal

Remove all build artifacts and cache files from repository.

## Success Criteria

- [ ] All `__pycache__/` directories removed
- [ ] All `.pytest_cache/` directories removed
- [ ] All `.mypy_cache/` directories removed
- [ ] All `*.pyc` files removed
- [ ] Coverage reports removed (`coverage_html/`, `htmlcov/`)
- [ ] Temporary directories removed (`tmp/`)
- [ ] Repository size reduced
- [ ] Tests still pass after cleanup

## Implementation Steps

### Step 1: Remove Python Cache Files

```bash
cd /Users/markr/kleptocracy-timeline

# Remove __pycache__ directories
find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true

# Remove .pyc files
find . -type f -name "*.pyc" -delete

# Remove .pyo files (optimized bytecode)
find . -type f -name "*.pyo" -delete

# Verify removal
find . -name "__pycache__" -o -name "*.pyc" -o -name "*.pyo"
# Should return nothing
```

### Step 2: Remove Test Cache Directories

```bash
# Remove pytest cache
find . -type d -name ".pytest_cache" -exec rm -rf {} + 2>/dev/null || true

# Verify removal
find . -name ".pytest_cache"
# Should return nothing
```

### Step 3: Remove Type Checking Cache

```bash
# Remove mypy cache
find . -type d -name ".mypy_cache" -exec rm -rf {} + 2>/dev/null || true

# Verify removal
find . -name ".mypy_cache"
# Should return nothing
```

### Step 4: Remove Coverage Reports

```bash
# Remove coverage HTML reports
rm -rf coverage_html/
rm -rf htmlcov/
rm -f .coverage
rm -f coverage.xml

# Verify removal
ls -la | grep -E "coverage|htmlcov"
# Should return nothing
```

### Step 5: Remove Temporary Directories

```bash
# Remove tmp directory
rm -rf tmp/

# Verify removal
ls -la | grep "^d.*tmp"
# Should return nothing
```

### Step 6: Check Repository Size

```bash
# Check size before cleanup (if not already done)
du -sh .

# Check git status
git status

# You should see deletions for cache files
```

## Validation Steps

### Test 1: Verify All Artifacts Removed

```bash
# Check for Python cache
find . -type d -name "__pycache__" | wc -l
# Should be 0

# Check for pyc files
find . -name "*.pyc" | wc -l
# Should be 0

# Check for test cache
find . -name ".pytest_cache" | wc -l
# Should be 0

# Check for mypy cache
find . -name ".mypy_cache" | wc -l
# Should be 0

# Check for coverage
ls coverage_html htmlcov tmp 2>/dev/null | wc -l
# Should be 0
```

### Test 2: Tests Still Pass

```bash
# Run tests to ensure nothing broke
cd research-server
pytest tests/ -v

# Should pass all tests
```

### Test 3: Applications Still Work

```bash
# Start research server
python3 research-server/cli/research_cli.py server-status

# Should show server status without errors
```

## Files to Remove

**Python Cache** (regenerated automatically):
- `__pycache__/` (multiple locations)
- `*.pyc` files
- `*.pyo` files

**Test Cache** (regenerated by pytest):
- `.pytest_cache/` (multiple locations)

**Type Checking Cache** (regenerated by mypy):
- `.mypy_cache/`

**Coverage Reports** (regenerated by pytest-cov):
- `coverage_html/`
- `htmlcov/`
- `.coverage`
- `coverage.xml`

**Temporary Files**:
- `tmp/`

## Post-Cleanup Actions

After removing artifacts, ensure they don't come back:

```bash
# Stage deletions
git add -A

# Commit
git commit -m "SPEC-005: Remove build artifacts and cache files

- Remove __pycache__/ directories
- Remove .pytest_cache/ directories
- Remove .mypy_cache/ directory
- Remove coverage reports (coverage_html/, htmlcov/)
- Remove temporary files (tmp/)
- Reduce repository bloat"

# Verify clean state
git status
# Should show "working tree clean"
```

## Rollback Plan

If something breaks (unlikely):

```bash
# Restore from git (if not committed yet)
git restore .
git clean -fd

# Or restore from last commit
git reset --hard HEAD

# Cache files will regenerate automatically on next run
```

## Dependencies

- None (safe cleanup operation)

## Risks & Mitigations

**Risk**: Accidentally remove important files
**Mitigation**: Using specific patterns (`__pycache__`, `*.pyc`, etc.) that are known build artifacts

**Risk**: Tests fail after cleanup
**Mitigation**: Run tests after cleanup to verify

## Notes

- These files are typically in `.gitignore` but may have been committed before gitignore was updated
- Removing these files does not affect functionality
- Files will regenerate automatically when needed
- This is standard repository hygiene

## Acceptance Criteria

- [x] All Python cache removed
- [x] All test cache removed
- [x] All type checking cache removed
- [x] All coverage reports removed
- [x] All temporary directories removed
- [x] Tests still pass
- [x] Server still works
- [x] Changes committed

## Size Impact

Expected repository size reduction: 5-20MB (varies based on cache size)
